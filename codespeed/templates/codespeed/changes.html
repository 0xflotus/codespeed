{% extends "base.html" %}
{% block title %}{{ block.super }}: Changes{% endblock %}
{% block extra_head %}
{{ block.super }}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.tablesorter.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/changes.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>
<script type="text/javascript">
    var projectmatrix = eval({{ projectmatrix|safe }});
    var revisionboxes = new Object();
    {% for project, revlist in revisionboxes.items %}
    revisionboxes['{{ project }}'] = '{% for rev in revlist %}<option value="{{ rev.commitid }}">{{ rev }}</option>{% endfor %}';{% endfor %}
    var currentproject = "{{ defaultexecutable.project }}";
    var changethres = {{ defaultchangethres }};
    var trendthres = {{ defaulttrendthres }};
    var timeline_url = "{% url timeline %}";

    $(function() {
        // Configure defaults
        $("#trend").val("{{ defaulttrend }}");
        $("#trend").change(refreshContent);

        $("input:radio[name=executable]").filter('[value="{{ defaultexecutable.id }}"]').attr('checked', true);
        $("input[name='executable']").change(changerevisions);

        $("input:radio[name='environment']").filter('[value="{{ defaultenvironment.id }}"]').attr('checked', true);
        $("input[name='environment']").change(refreshContent);

        //repopulate revision select box if the project has changed
        $("#revision").html(revisionboxes['{{ defaultexecutable.project.name }}']);
        $("#revision").val("{{ selectedrevision.commitid }}");
        $("#revision").change(refreshContent);

        refreshContent();
    });
</script>
{% endblock %}

{% block navigation %}
    {{ block.super }}
{% endblock %}
{% block nav-changes %}class="current"><a href="{% url changes %}">Changes</a>{% endblock %}

{% block body %}
<div id="sidebar">
<div class="sidebox">
  <div class="boxhead"><h2>Environment</h2></div>
  <div class="boxbody">
    <ul>
    {% for env in environments %}
      <li title="{{ env.os }}, {{ env.cpu }}">
        <input id="env{{ env.name }}" type="radio" name="environment" value="{{ env.id }}" />
        <label for="env{{ env.name }}">{{ env }}</label>
      </li>
    {% endfor %}
    </ul>
  </div>
</div>

<div id="executable" class="sidebox">
  <div class="boxhead"><h2>Executable</h2></div>
  <div class="boxbody">
    {% if executables|length > 1 %}<ul>{% endif %}{% for proj, execs in executables.items %}
      <ul>{% if executables|length > 1 %}{{ proj }}{% endif %}{% for exec in execs|dictsort:"name" %}
        <li title="{{ exec.description }}"><!-- the input id != value. It is used for exeutable color order -->
          <input id="executable{{ exec.id }}" type="radio" name="executable" value="{{ exec.id }}" />
          <label for="executable{{ exec.id }}">{{ exec }}</label><div class="seriescolor"></div>
        </li>{% endfor %}
      </ul>
    {% endfor %}
    {% if executables|length > 1 %}</ul>{% endif %}
  </div>
</div>

<div id="options" class="sidebox">
  <div class="boxhead"><h2>Options</h2></div>
  <div class="boxbody">
  <ul>
    <li title="Trend since a given number of tested revisions ago. Average of 3 revisions">Trend for last<br/>
      <select id="trend">
      {% for trend in trends %}<option value="{{ trend }}">{{ trend }}</option>{% endfor %}
      </select> revisions
    </li>
  </ul>
  </div>
</div>

</div>

<div id="configbar">
  <span class="options">Results for revision <select id="revision"></select></span>
  <a id="permalink" href="javascript:permalink();">Permalink</a>
</div>
<div id="content" class="clearfix">
<div id="contentwrap"></div>
</div>
{% endblock %}
